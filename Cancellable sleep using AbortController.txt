‚èπÔ∏è Cancellable sleep using AbortController

This allows you to cancel a pending sleep, which is very useful in:

request timeouts

component unmounts (React)

job/task cancellation

‚úÖ Implementation
function sleep(millis, signal) {
  return new Promise((resolve, reject) => {
    const timer = setTimeout(resolve, millis);

    if (signal) {
      signal.addEventListener(
        "abort",
        () => {
          clearTimeout(timer);
          reject(new Error("Sleep aborted"));
        },
        { once: true }
      );
    }
  });
}

‚úÖ Usage Example
const controller = new AbortController();

sleep(3000, controller.signal)
  .then(() => console.log("Completed"))
  .catch(err => console.log(err.message));

setTimeout(() => controller.abort(), 1000);


‚è±Ô∏è Output after ~1s:

Sleep aborted

üß† Interview Explanation (memorize this)

‚ÄúI wrap setTimeout in a Promise.
If an AbortSignal is provided, I listen for the abort event, clear the timer, and reject the Promise.‚Äù

‚ö†Ô∏è Important Details Interviewers Love

{ once: true } prevents memory leaks

clearTimeout avoids unnecessary work

Rejection allows proper error handling

Aligns with Fetch API cancellation semantics

‚≠ê Bonus: async/await version
async function demo() {
  const controller = new AbortController();

  try {
    await sleep(3000, controller.signal);
    console.log("Done");
  } catch {
    console.log("Cancelled");
  }
}
